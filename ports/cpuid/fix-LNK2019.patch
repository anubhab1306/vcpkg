diff --git a/libcpuid/CMakeLists.txt b/libcpuid/CMakeLists.txt
index 09189ef..f82de28 100644
--- a/libcpuid/CMakeLists.txt
+++ b/libcpuid/CMakeLists.txt
@@ -14,14 +14,14 @@ set(cpuid_sources
     asm-bits.c
     rdcpuid.c)
 
-if(WIN32)
+if(MSVC)
   list(APPEND cpuid_sources msrdriver.c)
 endif()
 if(UNIX)
   add_compile_definitions(_GNU_SOURCE)
 endif(UNIX)
 
-if("${MSVC_CXX_ARCHITECTURE_ID}" MATCHES "x64")
+if(MSVC AND CMAKE_VS_PLATFORM_NAME STREQUAL "x64")
   list(APPEND cpuid_sources masm-x64.asm)
 endif()
 
